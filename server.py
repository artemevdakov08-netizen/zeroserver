from flask import Flask, request, jsonify
import os, json

app = Flask(__name__)

# –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤
DB_FILE = "players.json"

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
if os.path.exists(DB_FILE):
    with open(DB_FILE, "r") as f:
        players = json.load(f)
else:
    players = {}

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–º–æ–∫–æ–¥—ã –∏–∑ —Ñ–∞–π–ª–∞
PROMO_FILE = "promo_codes.json"
if os.path.exists(PROMO_FILE):
    with open(PROMO_FILE, "r") as f:
        promo_codes = json.load(f)
else:
    promo_codes = {
        "ZERO": 1000,         # –æ—Ç—Å—ã–ª–∫–∞ –∫ ZERO Breaker (1)
	    "NEZOKS": 2500,       # —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π –∫–æ–¥ —Ñ–∞–Ω–∞—Ç–æ–≤ Nezoks (2)
	    "–ò–ì–†–ê": 1500,         # –±–∞–∑–æ–≤—ã–π –∫–æ–¥ (3)
	    "–ö–ê–†–¢–´": 2000,        # –∫–∞—Ä—Ç–æ—á–Ω–∞—è —Ç–µ–º–∞—Ç–∏–∫–∞ (4)
	    "–ê–ú–ù–ò–°–¢–ò–ô": 3000,     # —Ä–µ–¥–∫–∏–π —Å—é–∂–µ—Ç–Ω—ã–π –∫–æ–¥ (5)
	    "–ú–ò–†": 5000,          # ¬´–ú–∏—Ä¬ª ‚Äî —Ä–µ–¥–∫–∏–π –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–¥ (6)
	    "–î–ï–ù–¨–ì–ò": 777,        # –æ—á–µ–≤–∏–¥–Ω—ã–π –∫–æ–¥ (7)
	    "–£–î–ê–ß–ê": 3333,        # –∫–æ–¥ –¥–ª—è –≤–µ–∑—É–Ω—á–∏–∫–æ–≤ (8)
	    "–ü–Ø–¢–ù–ò–¶–ê": 3000,     # –≤ —á–µ—Å—Ç—å –º–µ–Ω—è - —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (9)
	    "–°–ï–ö–†–ï–¢": 9999,        # —Å–∫—Ä—ã—Ç—ã–π –∫–æ–¥ (10)
	    "DEEBING": 3000,     # –í –ß–µ—Å—Ç—å –º–µ–Ω—è - —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (11)
	    "–í–ò–ö–ê": 5000,     # –≤ —á–µ—Å—Ç—å —Å–µ—Å—Ç—Ä—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (12)
	    "–ü–†–ò–ó–†–ê–ö": 500,     # –¥–ª—è –ø–∞—Ç—É—Å—Ç–∞—Ä–æ–Ω–µ–≥–æ –º–∏—Ä–∞ (13)
	    "+5": 500,     # –æ—á–µ–≤–∏–¥–Ω—ã–π –∫–æ–¥ +5 (14)
	    "–ü–†–û–ò–ì–†–´–®–¨": 200,     # –∫–æ–¥ –æ—Å–æ—Ü–∏–∏—Ä—É–µ—Ç —Å–µ–±—è —Ç–æ —á—Ç–æ —Ç—ã –ø—Ä–æ–∏–≥—Ä–∞–ª (15)
	    "–†–û–ë–û–¢": 400,     # –≤ —á–µ—Å—Ç—å —Ä–µ–∂–∏–º–∞ –ø–≤–ø —Å —Ä–æ–±–æ—Ç–æ–º (16)
	    "GODOT": 5000,     # –≤ —á–µ—Å—Ç—å –¥–≤–∏–∂–∫–∞ –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏–≥—Ä–∞ (17)
	    "PLAY": 1000,     # –æ—á–µ–≤–∏–¥–Ω–æ –∫–Ω–æ–ø–∫–∞ "–∏–≥—Ä–∞—Ç—å" (18)
	    "1.0": 300,     # –≤ —á–µ—Å—Ç—å –ø–µ—Ä–≤–æ–π –≤–µ—Ä—Å–∏–∏ –∏–≥—Ä—ã (19)
	    "WaffleEater3000": 3000,     # –≤ —á–µ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (20)
	    "–ö–†–ê–°–ù–´–ô": 500, # –∫–∞—Ä—Ç–∞ –∫—Ä–∞—Å–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ (21)
	    "–°–¢–ê–†–¢": 1000, # –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É (22)
	    "–ü–ï–†–í–´–ô –•–û–î": 1200, # —Ç–≤–æ–π (23)
	    "–®–ê–ù–°": 1000, # —à–∞–Ω—Å –Ω–∞ –≤—ã–π–≥—Ä—ã—à—å –≤ –∏–≥—Ä–µ (24)
	    "–ë–û–ù–£–°": 1200, # –º–æ–∂–µ—Ç –±—ã—Ç—å? (25)
	    "–ö–û–ú–ë–û": 1300, # –≤ –∫–æ–ª–µ—Å–µ —É–¥–∞—á–∏ (26)
	    "–•–û–î": 900, # —Ç–≤–æ–π –∏–ª–∏ —á—É–∂–æ–π —Ö–æ–¥ (27)
	    "–°–î–ï–õ–ö–ê": 1400, # —Å –∫–æ–ª–µ—Å–æ–º —É–¥–∞—á–∏ (28)
	    "–¢–£–†": 1100, # —Ç—É—Ä–Ω–∏—Ä –æ–Ω–ª–∞–π–Ω (29)
	    "–†–ï–®–ï–ù–ò–ï": 2500, # —Ä–µ—à–µ–Ω–∏—è —Å–¥–µ–ª–∞—Ç—å —ç—Ç—É –∏–≥—Ä—É –≤–æ—Å–æ–∑–¥–∞–ª–æ –µ—ë (30)
	    "–ú–û–ù–ï–¢–ê": 2000, # –º–æ–Ω–µ—Ç–∞ —Ç–æ –∑–∞ —á—Ç–æ –º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å –≤—Å–µ –≤ –∏–≥—Ä–µ (31)
	    "–ü–†–û–†–´–í": 3500, # –≤ –∏–≥—Ä–µ (32)
    	"–ü–†–û–ë–£–ñ–î–ï–ù–ò–ï": 3000, # –∏–≥—Ä–∞ –ø—Ä–æ–±—É–∂–¥–∞–µ—Ç—Å—è (33)
	    "–¢–ï–ù–¨": 4000, # —Ç–µ–Ω—å –ø—Ä–æ—à–ª–æ–≥–æ –≤ –∏–≥—Ä–µ –∞ –∏–º–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (34)
	    "–†–ï–í–ê–ù–®": 3000, # —Ä–µ–≤–∞–Ω—à –≤ –±–∏—Ç–≤–∞—Ö (35)
	    "–ü–ê–ú–Ø–¢–¨": 3500, # –Ω—É–∂–Ω–∞ –±–æ–ª—å—à–∞—è –ø–∞–º—è—Ç—å —á—Ç–æ–±—ã –∑–∞–ø–æ–º–Ω–∏—Ç—å —ç—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã (36)
	    "–ú–£–ó–´–ö–ê": 3000, # –≥–ª–∞–≤–Ω–∞—è –º—É–∑—ã–∫–∞ –≤ –∏–≥—Ä–µ (37)
	    "–ö–û–î505": 6000, # –∫–æ–¥ 505 —á—Ç–æ–±—ã –≤–æ–π—Ç–∏ –≤ –ø–æ—Ç—É—Å—Ç–∞—Ä–æ–Ω–∏–π –º–∏—Ä (38)
    	"–°–ò–õ–ê": 6000, # —Å–∏–ª–∞ –≤ –æ—Å–æ–±–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–∞—Ö (39)
	    "–û–ì–û–ù–¨": 7000, # –º–∏—Ä\–∫–æ–º–ø–∞–Ω–∏—è - –æ–≥–æ–Ω—å (40)
	    "–ü–£–õ–¨–°": 5000, # –±–æ–ª—å—à–æ–π –ø—É–ª—å—Å –≤ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä –±—ã–ª (41)
    	"–ë–û–ì": 10000, # –±–æ—Å—Å –±–æ–≥ (42)
    	"–§–ò–ù–ê–õ": 15000, # –Ω–∞–º–µ–∫ –Ω–∞ –±—É–¥—É—â–µ–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (43)
    	"–°–õ–£–ß–ê–ô": 20000, # —Å–∏–º–≤–æ–ª –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ—Å—Ç–∏ –≤ –∏–≥—Ä–µ (44)
    	"–ù–û–õ–¨": 30000, # –∫–∞—Ä—Ç—É 0 –º–æ–∂–Ω–æ –æ—Ç–±–∏—Ç—å –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ (45)
    	"–ö–û–ù–¢–†–û–õ–¨": 25000, # —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç (46)
    	"–ü–ï–†–ï–ó–ê–ü–£–°–ö": 18000, # –Ω–∞–º–µ–∫ –Ω–∞ –±—É–¥—É—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (47)
    	"–≠–•–û": 4500, # –Ω–∞–º–µ–∫ –Ω–∞ –ø—Ä–æ—à–ª—ã–µ –∏–≥—Ä—ã –∫–æ—Ç–æ—Ä–æ–π –Ω–µ –≤—ã—à–ª–∏ (48)
    	"–ò–õ–õ–Æ–ó–ò–Ø": 5500, # –¥–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –∑–∞–≥–∞–¥–æ–∫ (49)
    	"–§–û–†–¢–£–ù–ê": 7000, # —Å–∏–º–≤–æ–ª —á–∏—Å—Ç–æ–π —É–¥–∞—á–∏ –≤ –∫–æ–ª–µ—Å–µ —É–¥–∞—á–∏ (50)
    }  # –ø–æ–∫–∞ –ø—É—Å—Ç–æ, –ø–æ—Ç–æ–º –∑–∞–ø–æ–ª–Ω–∏ JSON —Å 50 –∫–æ–¥–∞–º–∏

def save_db():
    with open(DB_FILE, "w") as f:
        json.dump(players, f)

@app.route("/")
def home():
    return "‚úÖ ZERO Breaker Server —Ä–∞–±–æ—Ç–∞–µ—Ç!"

# üìú –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
@app.route("/register", methods=["POST"])
def register():
    data = request.json
    username = data.get("username")
    password = data.get("password")

    if not username or not password:
        return jsonify({"status": "error", "message": "–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –∏ –ø–∞—Ä–æ–ª—å!"}), 400

    if username in players:
        return jsonify({"status": "error", "message": "–ò–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ!"}), 400

    players[username] = {"password": password, "money": 1000, "used_codes": []}
    save_db()
    return jsonify({"status": "ok", "message": "–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω", "player": players[username]})

# üí∞ –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
@app.route("/player/<username>")
def get_player(username):
    if username not in players:
        return jsonify({"status": "error", "message": "–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω!"}), 404
    return jsonify(players[username])

# üéÅ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
@app.route("/promo", methods=["POST"])
def promo():
    data = request.json
    username = data.get("username")
    code = data.get("code")

    if username not in players:
        return jsonify({"status": "error", "message": "–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω!"}), 404

    if code in players[username]["used_codes"]:
        return jsonify({"status": "error", "message": "–ö–æ–¥ —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!"}), 400

    if code in promo_codes:
        reward = promo_codes[code]
        players[username]["money"] += reward
        players[username]["used_codes"].append(code)
        save_db()
        return jsonify({"status": "ok", "message": f"–ù–∞—á–∏—Å–ª–µ–Ω–æ {reward} –º–æ–Ω–µ—Ç!"})
    else:
        return jsonify({"status": "error", "message": "–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!"}), 400

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 10000))
    app.run(host="0.0.0.0", port=port)

# —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞

@app.route("/delete/<username>", methods=["POST"])
def delete_account(username):
    if username in players:
        del players[username]
        return jsonify({"status": "ok", "message": f"–ê–∫–∫–∞—É–Ω—Ç {username} —É–¥–∞–ª—ë–Ω"})
    else:
        return jsonify({"status": "error", "message": "–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω"}), 404








